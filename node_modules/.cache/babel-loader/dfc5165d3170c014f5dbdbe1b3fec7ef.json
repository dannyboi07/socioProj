{"ast":null,"code":"import _toConsumableArray from\"/home/runner/work/socioProj/socioProj/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/home/runner/work/socioProj/socioProj/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/runner/work/socioProj/socioProj/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/runner/work/socioProj/socioProj/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useRef,useEffect}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import{likePostRdx,unLikePostRdx}from\"../../reducers/postblogReducer\";import{getPostComms,getPostLikers,postComm}from\"../../services/contentService\";import ProfileList from\"../ProfileList/ProfileList\";import CommentsList from\"../CommentsList/CommentsList\";import{Text}from\"../../styledComponents/Text\";import\"./postdetails.css\";import{setStatusNotif}from\"../../reducers/statusNotifReducer\";import{TextActionCol}from\"../../styledComponents/TextActionCol\";import{TextArea}from\"../../styledComponents/CommInput\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function PostDetails(_ref){var postUid=_ref.postUid,postId=_ref.postId,likes=_ref.likes,liked=_ref.liked,noComments=_ref.noComments,inFlscrn=_ref.inFlscrn;var dispatch=useDispatch();var userData=useSelector(function(state){return state.user;});var _useState=useState(parseInt(likes)),_useState2=_slicedToArray(_useState,2),likesCount=_useState2[0],setLikesCount=_useState2[1];var _useState3=useState({display:\"none\"}),_useState4=_slicedToArray(_useState3,2),likestate=_useState4[0],setLikestate=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),likeResults=_useState6[0],setLikeResults=_useState6[1];var _useState7=useState(liked),_useState8=_slicedToArray(_useState7,2),ulikedOrNot=_useState8[0],setuLikedOrNot=_useState8[1];var arwBtn=useRef(null);var profListRef=useRef(null);var _useState9=useState(parseInt(noComments)),_useState10=_slicedToArray(_useState9,2),comCount=_useState10[0],setComCount=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),comsResults=_useState12[0],setComsResults=_useState12[1];var _useState13=useState({display:\"none\"}),_useState14=_slicedToArray(_useState13,2),comsState=_useState14[0],setComsState=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),comInputState=_useState16[0],setComInputState=_useState16[1];var commListRef=useRef(null);var comInputRef=useRef(null);var comSubRef=useRef(null);var cmtArwBtn=useRef(null);// console.log(comCount, noComments);\nfunction OnInput(){this.style.height=\"2.5em\";this.style.height=this.scrollHeight+\"px\";}useEffect(function(){comInputRef.current.style=\"height: 2.35em; overflow-y: hidden;\";comInputRef.current.addEventListener(\"input\",OnInput);comInputRef.current.addEventListener(\"keyup\",handleEntClick);// return () => {\n//   console.log(comInputRef.current);\n//   comInputRef.current.removeEventListener(\"input\", OnInput);\n//   comInputRef.current.removeEventListener(\"keyup\", handleEntClick);\n// };\n},[]);var timer=null;function handleEntClick(e){e.preventDefault();if(e.key===\"Enter\"&&comInputState!==\"\"){comSubRef.current.click();}}function showLikes(){if(!likeResults)getLikes();if(timer)clearTimeout(timer);timer=setTimeout(function(){setLikestate({display:\"block\"});setTimeout(function(){profListRef.current.classList.add(\"show-ctn\");arwBtn.current.classList.add(\"toggle-btn--active\");},15);},0);}function hideLikes(){if(timer)clearTimeout(timer);profListRef.current.classList.remove(\"show-ctn\");arwBtn.current.classList.remove(\"toggle-btn--active\");timer=setTimeout(function(){setLikestate({display:\"none\"});},150);}function getLikes(){return _getLikes.apply(this,arguments);}function _getLikes(){_getLikes=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=setLikeResults;_context.next=3;return getPostLikers(postId);case 3:_context.t1=_context.sent;(0,_context.t0)(_context.t1);case 5:case\"end\":return _context.stop();}}},_callee);}));return _getLikes.apply(this,arguments);}function showLikesAsBlock(){arwBtn.current.classList.toggle(\"toggle-btn--active\");likestate.display===\"none\"?showLikes():hideLikes();}function handlePostLikeClick(){if(userData.uId===postUid){dispatch(setStatusNotif(\"SET_ERR_NOTIF\",\"Cannot like your own post\",2));return;}if(ulikedOrNot){dispatch(unLikePostRdx(postId,userData.token));setuLikedOrNot(false);setLikesCount(likesCount-1);showLikes();}else{dispatch(likePostRdx(postId,userData.token));setuLikedOrNot(true);setLikesCount(likesCount+1);showLikes();}}var commTimer=null;function getComms(){return _getComms.apply(this,arguments);}function _getComms(){_getComms=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.t0=setComsResults;_context2.next=3;return getPostComms(postId);case 3:_context2.t1=_context2.sent;(0,_context2.t0)(_context2.t1);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return _getComms.apply(this,arguments);}function showComms(){if(!comsResults)getComms();if(commTimer)clearTimeout(commTimer);commTimer=setTimeout(function(){setComsState({display:\"block\"});setTimeout(function(){commListRef.current.classList.add(\"show-comm-ctn\");cmtArwBtn.current.classList.add(\"toggle-btn--active\");},15);},0);}function hideComms(){if(commTimer)clearTimeout(commTimer);commListRef.current.classList.remove(\"show-comm-ctn\");cmtArwBtn.current.classList.remove(\"toggle-btn--active\");commTimer=setTimeout(function(){setComsState({display:\"none\"});},200);}function showCmtsAsBlock(){cmtArwBtn.current.classList.toggle(\"toggle-btn--active\");comsState.display===\"none\"?showComms():hideComms();}function postComment(){return _postComment.apply(this,arguments);}function _postComment(){_postComment=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var newComResp;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return postComm(postId,comInputState,userData.token);case 3:newComResp=_context3.sent;setComInputState(null);comInputRef.current.value=null;setComCount(comCount+1);if(comsResults){setComsResults([].concat(_toConsumableArray(comsResults),[newComResp]));}else getComms();_context3.next=13;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](0);console.error(\"Error posting comment\");case 13:case\"end\":return _context3.stop();}}},_callee3,null,[[0,10]]);}));return _postComment.apply(this,arguments);}return/*#__PURE__*/_jsxs(\"div\",{className:\"post-details-ctn \".concat(inFlscrn?\"pst-det-ctn--mod\":\"\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"details-ctn\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"like-btn-ctn\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"like-btn\",onClick:handlePostLikeClick,onTouchStart:showLikes,onTouchEnd:hideLikes,onMouseOver:showLikes,onMouseOut:hideLikes,children:[/*#__PURE__*/_jsx(Text,{children:likesCount}),/*#__PURE__*/_jsx(\"img\",{className:ulikedOrNot?\"\":\"like-icon\",src:ulikedOrNot?\"/liked-svg.gif\":\"/heart.svg\",alt:\"like-icon\"})]}),/*#__PURE__*/_jsx(ProfileList,{className:\"likes-ctn\",postId:postId,likestate:likestate,likeResults:likeResults,profListRef:profListRef}),/*#__PURE__*/_jsx(\"button\",{id:\"tglBtn\".concat(postId),className:\"toggle-btn\",onClick:showLikesAsBlock,ref:arwBtn,children:/*#__PURE__*/_jsx(\"img\",{src:\"/icon-arrow-down.svg\",alt:\"toggle-likes\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"comments-btn-ctn\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"comments-btn\",onTouchStart:showComms,onTouchEnd:hideComms,onMouseOver:showComms,onMouseOut:hideComms,children:/*#__PURE__*/_jsxs(Text,{children:[\"Comments: \",comCount]})}),/*#__PURE__*/_jsx(\"button\",{className:\"toggle-btn\",onClick:showCmtsAsBlock,ref:cmtArwBtn,children:/*#__PURE__*/_jsx(\"img\",{src:\"/icon-arrow-down.svg\",alt:\"toggle-cmts\"})})]}),/*#__PURE__*/_jsx(CommentsList,{postId:postId,comsState:comsState,commentsData:comsResults,commListRef:commListRef,inFlscrn:inFlscrn})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"input-cmt-ctn\",children:[/*#__PURE__*/_jsx(TextArea,{value:comInputState,onChange:function onChange(e){return setComInputState(e.target.value);},placeholder:\"Comment...\",ref:comInputRef}),/*#__PURE__*/_jsx(\"button\",{className:comInputState===\"\"?\"post-cmt-btn-dis\":\"\",onClick:postComment,disabled:comInputState===\"\"?true:false,ref:comSubRef,children:/*#__PURE__*/_jsx(TextActionCol,{children:\"Post\"})})]})]});}export default PostDetails;","map":{"version":3,"sources":["/home/runner/work/socioProj/socioProj/src/components/PostDetails/PostDetails.js"],"names":["React","useState","useRef","useEffect","useSelector","useDispatch","likePostRdx","unLikePostRdx","getPostComms","getPostLikers","postComm","ProfileList","CommentsList","Text","setStatusNotif","TextActionCol","TextArea","PostDetails","postUid","postId","likes","liked","noComments","inFlscrn","dispatch","userData","state","user","parseInt","likesCount","setLikesCount","display","likestate","setLikestate","likeResults","setLikeResults","ulikedOrNot","setuLikedOrNot","arwBtn","profListRef","comCount","setComCount","comsResults","setComsResults","comsState","setComsState","comInputState","setComInputState","commListRef","comInputRef","comSubRef","cmtArwBtn","OnInput","style","height","scrollHeight","current","addEventListener","handleEntClick","timer","e","preventDefault","key","click","showLikes","getLikes","clearTimeout","setTimeout","classList","add","hideLikes","remove","showLikesAsBlock","toggle","handlePostLikeClick","uId","token","commTimer","getComms","showComms","hideComms","showCmtsAsBlock","postComment","newComResp","value","console","error","target"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { likePostRdx, unLikePostRdx } from \"../../reducers/postblogReducer\";\nimport { getPostComms, getPostLikers, postComm } from \"../../services/contentService\";\nimport ProfileList from \"../ProfileList/ProfileList\";\nimport CommentsList from \"../CommentsList/CommentsList\";\nimport { Text } from \"../../styledComponents/Text\";\nimport \"./postdetails.css\";\nimport { setStatusNotif } from \"../../reducers/statusNotifReducer\";\nimport { TextActionCol } from \"../../styledComponents/TextActionCol\";\nimport { TextArea } from \"../../styledComponents/CommInput\";\n\nfunction PostDetails({ postUid, postId, likes, liked, noComments, inFlscrn }) {\n\tconst dispatch = useDispatch();\n\tconst userData = useSelector(state => state.user);\n\n\tconst [likesCount, setLikesCount] = useState(parseInt(likes));\n\tconst [likestate, setLikestate] = useState({ display: \"none\" });\n\tconst [likeResults, setLikeResults] = useState(null);\n\tconst [ulikedOrNot, setuLikedOrNot] = useState(liked);\n\tconst arwBtn = useRef(null);\n\tconst profListRef = useRef(null);\n\n\tconst [comCount, setComCount] = useState(parseInt(noComments));\n\tconst [comsResults, setComsResults] = useState(null);\n\tconst [comsState, setComsState] = useState({ display: \"none\" });\n\tconst [comInputState, setComInputState] = useState(\"\");\n\tconst commListRef = useRef(null);\n\tconst comInputRef = useRef(null);\n\tconst comSubRef = useRef(null);\n\tconst cmtArwBtn = useRef(null);\n\n\t// console.log(comCount, noComments);\n\n\tfunction OnInput() {\n\t\tthis.style.height = \"2.5em\";\n\t\tthis.style.height = this.scrollHeight + \"px\";\n\t}\n\n\tuseEffect(() => {\n\n\t\tcomInputRef.current.style = \"height: 2.35em; overflow-y: hidden;\";\n\t\tcomInputRef.current.addEventListener(\"input\", OnInput);\n\t\tcomInputRef.current.addEventListener(\"keyup\", handleEntClick);\n\n\t\t// return () => {\n\t\t//   console.log(comInputRef.current);\n\t\t//   comInputRef.current.removeEventListener(\"input\", OnInput);\n\t\t//   comInputRef.current.removeEventListener(\"keyup\", handleEntClick);\n\t\t// };\n\t}, []);\n\n\tlet timer = null;\n\n\tfunction handleEntClick(e) {\n\t\te.preventDefault();\n\t\tif (e.key === \"Enter\" && comInputState !== \"\") {\n\t\t\tcomSubRef.current.click();\n\t\t}\n\t}\n\n\tfunction showLikes() {\n\t\tif (!likeResults) getLikes();\n\n\t\tif (timer) clearTimeout(timer);\n\t\ttimer = setTimeout(() => {\n\t\t\tsetLikestate({ display: \"block\" });\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tprofListRef.current.classList.add(\"show-ctn\");\n\t\t\t\tarwBtn.current.classList.add(\"toggle-btn--active\");\n\t\t\t}, 15);\n\t\t}, 0);\n\t}\n\n\tfunction hideLikes() {\n\t\tif (timer) clearTimeout(timer);\n\n\t\tprofListRef.current.classList.remove(\"show-ctn\");\n\t\tarwBtn.current.classList.remove(\"toggle-btn--active\");\n\n\t\ttimer = setTimeout(() => {\n\t\t\tsetLikestate({ display: \"none\" });\n\t\t}, 150);\n\t}\n\n\tasync function getLikes() {\n\t\tsetLikeResults(await getPostLikers(postId));\n\t}\n\n\tfunction showLikesAsBlock() {\n\t\tarwBtn.current.classList.toggle(\"toggle-btn--active\");\n\n\t\tlikestate.display === \"none\"\n\t\t\t? showLikes()\n\t\t\t: hideLikes();\n\t}\n\n\tfunction handlePostLikeClick() {\n\t\tif (userData.uId === postUid) {\n\t\t\tdispatch(setStatusNotif(\"SET_ERR_NOTIF\", \"Cannot like your own post\", 2));\n\t\t\treturn;\n\t\t}\n\t\tif (ulikedOrNot) {\n\t\t\tdispatch(unLikePostRdx(postId, userData.token));\n\t\t\tsetuLikedOrNot(false);\n\t\t\tsetLikesCount(likesCount - 1);\n\t\t\tshowLikes();\n\t\t} else {\n\t\t\tdispatch(likePostRdx(postId, userData.token));\n\t\t\tsetuLikedOrNot(true);\n\t\t\tsetLikesCount(likesCount + 1);\n\t\t\tshowLikes();\n\t\t}\n\t}\n\n\tlet commTimer = null;\n\n\tasync function getComms() {\n\t\tsetComsResults(await getPostComms(postId));\n\t}\n\n\tfunction showComms() {\n\t\tif (!comsResults) getComms();\n\n\t\tif (commTimer) clearTimeout(commTimer);\n\t\tcommTimer = setTimeout(() => {\n\t\t\tsetComsState({ display: \"block\" });\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tcommListRef.current.classList.add(\"show-comm-ctn\");\n\t\t\t\tcmtArwBtn.current.classList.add(\"toggle-btn--active\");\n\t\t\t}, 15);\n\t\t}, 0);\n\t}\n\n\tfunction hideComms() {\n\t\tif (commTimer) clearTimeout(commTimer);\n\n\t\tcommListRef.current.classList.remove(\"show-comm-ctn\");\n\t\tcmtArwBtn.current.classList.remove(\"toggle-btn--active\");\n\n\t\tcommTimer = setTimeout(() => {\n\t\t\tsetComsState({ display: \"none\" });\n\t\t}, 200);\n\t}\n\n\tfunction showCmtsAsBlock() {\n\t\tcmtArwBtn.current.classList.toggle(\"toggle-btn--active\");\n\n\t\tcomsState.display === \"none\"\n\t\t\t? showComms()\n\t\t\t: hideComms();\n\t}\n\n\tasync function postComment() {\n\t\ttry {\n\t\t\tconst newComResp = await postComm(postId, comInputState, userData.token);\n\t\t\tsetComInputState(null);\n\t\t\tcomInputRef.current.value = null;\n\t\t\tsetComCount(comCount + 1);\n\n\t\t\tif (comsResults) {\n\t\t\t\tsetComsResults([ ...comsResults, newComResp]);\n\t\t\t}\n\t\t\telse getComms();\n\n\t\t} catch(err) {\n\t\t\tconsole.error(\"Error posting comment\");\n\t\t}\n\t}\n\n\treturn (\n\t\t<div className={`post-details-ctn ${inFlscrn ? \"pst-det-ctn--mod\" : \"\" }`}>\n\t\t\t<div className=\"details-ctn\">\n\t\t\t\t<div className=\"like-btn-ctn\">\n\t\t\t\t\t<button className=\"like-btn\"\n\t\t\t\t\t\tonClick={handlePostLikeClick}\n\t\t\t\t\t\tonTouchStart={showLikes}\n\t\t\t\t\t\tonTouchEnd={hideLikes}\n\t\t\t\t\t\tonMouseOver={showLikes}\n\t\t\t\t\t\tonMouseOut={hideLikes}>\n\t\t\t\t\t\t<Text>\n\t\t\t\t\t\t\t{ likesCount }\n\t\t\t\t\t\t</Text>\n\n\t\t\t\t\t\t<img className={ ulikedOrNot ? \"\" : \"like-icon\" } src={ ulikedOrNot ? \"/liked-svg.gif\" : \"/heart.svg\" } alt=\"like-icon\"/>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<ProfileList\n\t\t\t\t\t\tclassName=\"likes-ctn\"\n\t\t\t\t\t\tpostId={postId}\n\t\t\t\t\t\tlikestate={likestate}\n\t\t\t\t\t\tlikeResults={likeResults}\n\t\t\t\t\t\tprofListRef={profListRef}/>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\tid={`tglBtn${postId}`}\n\t\t\t\t\t\tclassName=\"toggle-btn\"\n\t\t\t\t\t\tonClick={showLikesAsBlock}\n\t\t\t\t\t\tref={arwBtn}>\n\t\t\t\t\t\t<img src=\"/icon-arrow-down.svg\" alt=\"toggle-likes\"/>\n\t\t\t\t\t</button>\n\n\t\t\t\t</div>\n\n\t\t\t\t<div className=\"comments-btn-ctn\">\n\t\t\t\t\t<button className=\"comments-btn\"\n\t\t\t\t\t\tonTouchStart={showComms}\n\t\t\t\t\t\tonTouchEnd={hideComms}\n\t\t\t\t\t\tonMouseOver={showComms}\n\t\t\t\t\t\tonMouseOut={hideComms}>\n\n\t\t\t\t\t\t<Text>\n              Comments: { comCount }\n\t\t\t\t\t\t</Text>\n\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\tclassName=\"toggle-btn\"\n\t\t\t\t\t\tonClick={ showCmtsAsBlock }\n\t\t\t\t\t\tref={ cmtArwBtn }>\n\t\t\t\t\t\t<img src=\"/icon-arrow-down.svg\" alt=\"toggle-cmts\"/>\n\t\t\t\t\t</button>\n\n\t\t\t\t</div>\n\n\t\t\t\t<CommentsList\n\t\t\t\t\tpostId={ postId }\n\t\t\t\t\tcomsState={ comsState }\n\t\t\t\t\tcommentsData={ comsResults }\n\t\t\t\t\tcommListRef={ commListRef }\n\t\t\t\t\tinFlscrn={ inFlscrn }/>\n\t\t\t</div>\n\n\t\t\t<div className=\"input-cmt-ctn\">\n\t\t\t\t<TextArea\n\t\t\t\t\tvalue={ comInputState }\n\t\t\t\t\tonChange={e => setComInputState(e.target.value)}\n\t\t\t\t\tplaceholder='Comment...'\n\t\t\t\t\tref={comInputRef}/>\n\n\t\t\t\t<button\n\t\t\t\t\tclassName={ comInputState === \"\" ? \"post-cmt-btn-dis\" : \"\" }\n\t\t\t\t\tonClick={ postComment } disabled={ comInputState === \"\" ? true : false }\n\t\t\t\t\tref={ comSubRef }>\n\n\t\t\t\t\t<TextActionCol>\n            Post\n\t\t\t\t\t</TextActionCol>\n\n\t\t\t\t</button>\n\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nexport default PostDetails;"]},"metadata":{},"sourceType":"module"}