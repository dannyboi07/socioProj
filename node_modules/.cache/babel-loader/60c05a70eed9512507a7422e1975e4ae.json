{"ast":null,"code":"import _asyncToGenerator from\"/home/runner/work/socioProj/socioProj/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/home/runner/work/socioProj/socioProj/node_modules/@babel/runtime/regenerator/index.js\";import{registerUser}from\"../services/registerService\";import{loginUser}from\"../services/loginService\";import{setStatusNotif}from\"./statusNotifReducer\";import changeroute from\"../utils/customEvents\";var userDetails=JSON.parse(window.localStorage.getItem(\"socioUser\"));var initialState=null;if(userDetails){initialState={name:userDetails.name,username:userDetails.username,profImgSrc:userDetails.profImgSrc,token:userDetails.token,uId:userDetails.uId};}export default function userReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;// console.log(action);\nswitch(action.type){case\"LOGIN\":// eslint-disable-next-line no-case-declarations\nvar _action$data=action.data,token=_action$data.token,name=_action$data.name,username=_action$data.username,profImgSrc=_action$data.profImgSrc,uId=_action$data.uId;return state={name:name,username:username,token:token,profImgSrc:profImgSrc,uId:uId};case\"SET_USER\":return state={name:action.data.name,username:action.data.username,uId:action.data.uId,token:action.data.token,profImgSrc:action.data.profImgSrc};case\"LOG_OUT\":return state=action.data;default:return state;}}function initializeUser(userDetails){return{type:\"SET_USER\",data:userDetails};}function dispatchRegister(userDetails){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var resUserDetails;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return registerUser(userDetails);case 3:_context.next=5;return loginUser({username:userDetails.get(\"username\"),password:userDetails.get(\"password\")});case 5:resUserDetails=_context.sent;_context.next=13;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.error(_context.t0);if(_context.t0.response.data.type===\"register\"){dispatch(setStatusNotif(\"SET_ERR_NOTIF\",_context.t0.response.data.error,3));}else if(_context.t0.response.data.type===\"login\"){dispatch(setStatusNotif(\"SET_ERR_NOTIF\",_context.t0.response.data.error,3));window.dispatchEvent(changeroute);}return _context.abrupt(\"return\");case 13:dispatch({type:\"LOGIN\",data:resUserDetails});dispatch(setStatusNotif(\"SET_NEU_NOTIF\",\"Registered and logged in\",3));case 15:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function(_x){return _ref.apply(this,arguments);};}();}function dispatchLogin(userDetails){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var loginRes,_loginRes,token,name,username,profImgSrc,uId;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return loginUser(userDetails);case 3:loginRes=_context2.sent;_loginRes=loginRes,token=_loginRes.token,name=_loginRes.name,username=_loginRes.username,profImgSrc=_loginRes.profImgSrc,uId=_loginRes.uId;window.localStorage.setItem(\"socioUser\",JSON.stringify({name:name,username:username,profImgSrc:profImgSrc,token:token,uId:uId}));// window.localStorage.setItem(\"socioTheme\", JSON.stringify({\n//   theme\n// }));\n_context2.next=13;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.error(_context2.t0);dispatch(setStatusNotif(\"SET_ERR_NOTIF\",_context2.t0.response.data.error,3));return _context2.abrupt(\"return\");case 13:dispatch({type:\"LOGIN\",data:loginRes});dispatch(setStatusNotif(\"SET_NEU_NOTIF\",\"Logged in\",3));case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();}function dispatchLogOut(){return function(dispatch){window.localStorage.removeItem(\"socioUser\");// window.localStorage.removeItem(\"socioTheme\");\ndispatch({type:\"LOG_OUT\",data:null});dispatch(setStatusNotif(\"SET_NEU_NOTIF\",\"Logged out\",2));};}export{initializeUser,dispatchRegister,dispatchLogin,dispatchLogOut};","map":{"version":3,"sources":["/home/runner/work/socioProj/socioProj/src/reducers/userReducer.js"],"names":["registerUser","loginUser","setStatusNotif","changeroute","userDetails","JSON","parse","window","localStorage","getItem","initialState","name","username","profImgSrc","token","uId","userReducer","state","action","type","data","initializeUser","dispatchRegister","dispatch","get","password","resUserDetails","console","error","response","dispatchEvent","dispatchLogin","loginRes","setItem","stringify","dispatchLogOut","removeItem"],"mappings":"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","sourcesContent":["import { registerUser } from \"../services/registerService\";\nimport { loginUser } from \"../services/loginService\";\nimport { setStatusNotif } from \"./statusNotifReducer\";\nimport changeroute from \"../utils/customEvents\";\n\nconst userDetails = JSON.parse(window.localStorage.getItem(\"socioUser\"));\nlet initialState = null;\n\nif (userDetails) {\n\tinitialState = {\n\t\tname: userDetails.name,\n\t\tusername: userDetails.username,\n\t\tprofImgSrc: userDetails.profImgSrc,\n\t\ttoken: userDetails.token,\n\t\tuId: userDetails.uId,\n\t};\n}\n\nexport default function userReducer(state = initialState, action) {\n\t// console.log(action);\n\tswitch (action.type) {\n\tcase \"LOGIN\":\n\t\t// eslint-disable-next-line no-case-declarations\n\t\tconst { token, name, username, profImgSrc, uId } = action.data;\n\n\t\treturn (state = { name, username, token, profImgSrc, uId });\n\n\tcase \"SET_USER\":\n\t\treturn (state = {\n\t\t\tname: action.data.name,\n\t\t\tusername: action.data.username,\n\t\t\tuId: action.data.uId,\n\t\t\ttoken: action.data.token,\n\t\t\tprofImgSrc: action.data.profImgSrc,\n\t\t});\n\n\tcase \"LOG_OUT\":\n\t\treturn (state = action.data);\n\n\tdefault:\n\t\treturn state;\n\t}\n}\n\nfunction initializeUser(userDetails) {\n\treturn {\n\t\ttype: \"SET_USER\",\n\t\tdata: userDetails,\n\t};\n}\n\nfunction dispatchRegister(userDetails) {\n\treturn async (dispatch) => {\n\t\t// let resRegUserDetails;\n\t\tlet resUserDetails;\n\t\ttry {\n\t\t\tawait registerUser(userDetails);\n\t\t\tresUserDetails = await loginUser({\n\t\t\t\tusername: userDetails.get(\"username\"),\n\t\t\t\tpassword: userDetails.get(\"password\"),\n\t\t\t});\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\t\t\tif (err.response.data.type === \"register\") {\n\t\t\t\tdispatch(\n\t\t\t\t\tsetStatusNotif(\"SET_ERR_NOTIF\", err.response.data.error, 3),\n\t\t\t\t);\n\t\t\t} else if (err.response.data.type === \"login\") {\n\t\t\t\tdispatch(\n\t\t\t\t\tsetStatusNotif(\"SET_ERR_NOTIF\", err.response.data.error, 3),\n\t\t\t\t);\n\t\t\t\twindow.dispatchEvent(changeroute);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tdispatch({\n\t\t\ttype: \"LOGIN\",\n\t\t\tdata: resUserDetails,\n\t\t});\n\t\tdispatch(\n\t\t\tsetStatusNotif(\"SET_NEU_NOTIF\", \"Registered and logged in\", 3),\n\t\t);\n\t};\n}\n\nfunction dispatchLogin(userDetails) {\n\treturn async (dispatch) => {\n\t\tlet loginRes;\n\n\t\ttry {\n\t\t\tloginRes = await loginUser(userDetails);\n\n\t\t\tconst { token, name, username, profImgSrc, uId } = loginRes;\n\t\t\twindow.localStorage.setItem(\n\t\t\t\t\"socioUser\",\n\t\t\t\tJSON.stringify({\n\t\t\t\t\tname,\n\t\t\t\t\tusername,\n\t\t\t\t\tprofImgSrc,\n\t\t\t\t\ttoken,\n\t\t\t\t\tuId,\n\t\t\t\t}),\n\t\t\t);\n\t\t\t// window.localStorage.setItem(\"socioTheme\", JSON.stringify({\n\t\t\t//   theme\n\t\t\t// }));\n\t\t} catch (err) {\n\t\t\tconsole.error(err);\n\t\t\tdispatch(\n\t\t\t\tsetStatusNotif(\"SET_ERR_NOTIF\", err.response.data.error, 3),\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tdispatch({\n\t\t\ttype: \"LOGIN\",\n\t\t\tdata: loginRes,\n\t\t});\n\t\tdispatch(setStatusNotif(\"SET_NEU_NOTIF\", \"Logged in\", 3));\n\t};\n}\n\nfunction dispatchLogOut() {\n\treturn (dispatch) => {\n\t\twindow.localStorage.removeItem(\"socioUser\");\n\t\t// window.localStorage.removeItem(\"socioTheme\");\n\t\tdispatch({\n\t\t\ttype: \"LOG_OUT\",\n\t\t\tdata: null,\n\t\t});\n\t\tdispatch(setStatusNotif(\"SET_NEU_NOTIF\", \"Logged out\", 2));\n\t};\n}\n\nexport { initializeUser, dispatchRegister, dispatchLogin, dispatchLogOut };\n"]},"metadata":{},"sourceType":"module"}